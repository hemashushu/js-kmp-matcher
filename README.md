# JS KMP Matcher

简单的 KMP 算法的实现，用于学习之目的，代码当中有每一部分的详细说明。

## KMP 算法简介

KMP 是一种在字符串里搜索指定关键字的方法，比如在各种文本编辑器里使用 "查找" 功能就是字符串搜索。

### 简单思想

1. 假设关键字字符串里存在有头尾重复（头尾一样）的子字符串；
2. 在暴力搜索的基础上，每当遇到字符不匹配的时候，跳过关键字当中有头尾重复的部分，以节省这部分的比较时间。
3. 如果关键字字符串里不存在任何头尾重复的子字符串（搜索中文关键字时大机率如此），实际上仍然是暴力搜索。

其中：

关键字子字符串是指从位置 0 开始，到每个不同的长度的部分，比如 0~1 是一个子串，0~2 是一个子串, 0~(N-1) 也是一个子串。

关键字 "abcd" 的所有子字符串：

- "a"
- "ab"
- "abc"
- "abcd"

### 搜索过程

KMP 搜索包括一个建立 "关键字部分匹配表" 和一个在字符串里搜索关键字的两个过程。

搜索过程跟暴力搜索很相似，都是用两个指针分别指向 "被搜索字符串" 当前正在比较的字符，以及 "关键字字符串" 当前正在比较的字符。

当两个字符相同时，两个指针同时前进；当两个字符不同时，暴力搜索会让第一个指针退回到第一个相同字符的后一个字符位置，第二个指针退回到 0。但 KMP 搜索会保持第一个指针不变，只让第二个指针跳回到重复头尾的后一个字符。具体实现比较简单，详细看代码 [kmp.js](./src/kmp.js)。

### 建立 "关键字部分匹配表" 的方法

"关键字部分匹配表" 也就是关键字在各个长度时的 "最大公共前后缀表"。跟搜索过程一样，也是可以用暴力搜索法创建，也可以利用建立过程中形成的半成品表来一个迷你的 KMP。

单纯用语言比较难描述，下面的是河马蜀黍自己乱想出来的实物演示法😅，动手做一下可以很快理解：

准备一条纸条，宽度为 1cm，长度为 keyword length cm，然后每一格（cm）填上一个字母。这时这条纸条就是关键字字符数组。

参考关键字：

- 'abaab'
- 'aaaab'
- 'aabaaa'
- 'abcdabd'

复制一条一模一样的纸条。

将两条纸条一上一下平铺，然后左右错开一格，再逐渐拉开，每次拉开一格，直到只剩下还连着一格为止，在拉开的过程中找到上下两条纸条内容重叠/相同的位置，这个重叠的长度就是 "最大公共前后缀长度"。

然后折掉最右边一格，重复上面的步骤，找到长度为 length - 1 时的 "最大公共前后缀长度"。

不断折掉最右边的一格，直到只剩下 2 格为止，找到所有长度下的  "最大公共前后缀长度"。（因为 1 个字符不存在前缀或后缀，所以不需要减到 1 个字符）。

实际计算时并不需要重复计算每一个长度的情况，只需计算一次最长的长度即可，因为由上面的演示可见，不同长度的前面的步骤都是 **一模一样** 的。

程序的过程如下：

```
如果 i （上纸条当前比较的字符的位置） 和 j （下纸条当前比较字符的位置） 的字符：
1. 不同：
   a. 如果 j == 0，则 i++
   b. 如果 j != 0, 有两种方式：
      I.  类似暴力搜索，
          将 i 退回到第 i-j+1，即 i 和 j 第一次相同的后一个字符，
          将 j 退回到 0。
      II. KMP 的现做现用，因为就目前（还不完整的）table 已经记录了部分头尾相同的子字符串，
          所以只需要将 j 退回到 table[j-1]，跳过头尾相同的部分即可。
          i 保持不变，且 j 不需要退回到 0。
2. 相同：则 i++, j++
```

## 单元测试

执行命令：

`$ npm test`

应该能看到 `testKMP() passed.` 字样。

## 单步调试/跟踪

有时可能跟踪程序的运行也能帮助对程序的理解，启动单步调试的方法是：

在 vscode 里打开该项目，然后在单元测试文件 [test-all.js](./test/test-all.js) 或者源码 [kmp.js](./src/kmp.js) 里设置断点，然后执行 `Run and Debug` 即可。
